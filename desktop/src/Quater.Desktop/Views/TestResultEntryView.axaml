<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Quater.Desktop.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="Quater.Desktop.Views.TestResultEntryView"
             x:DataType="vm:TestResultEntryViewModel">

  <Design.DataContext>
    <vm:TestResultEntryViewModel />
  </Design.DataContext>

  <ScrollViewer>
    <StackPanel Margin="20" Spacing="15" MaxWidth="600">

      <!-- Header -->
      <TextBlock Text="Test Result Entry"
                 FontSize="24"
                 FontWeight="Bold"
                 Margin="0,0,0,10" />

      <!-- Error Message -->
      <Border Background="#FFEBEE"
              BorderBrush="#F44336"
              BorderThickness="1"
              CornerRadius="4"
              Padding="10"
              IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
        <TextBlock Text="{Binding ErrorMessage}"
                   Foreground="#C62828"
                   TextWrapping="Wrap" />
      </Border>

      <!-- Parameter Selection -->
      <StackPanel Spacing="5">
        <TextBlock Text="Parameter *" FontWeight="SemiBold" />
        <ComboBox ItemsSource="{Binding AvailableParameters}"
                  SelectedItem="{Binding ParameterName}"
                  HorizontalAlignment="Stretch"
                  IsEnabled="{Binding !IsBusy}"
                  PlaceholderText="Select a parameter">
          <ComboBox.ItemTemplate>
            <DataTemplate>
              <TextBlock Text="{Binding Name}" />
            </DataTemplate>
          </ComboBox.ItemTemplate>
        </ComboBox>
      </StackPanel>

      <!-- Value and Unit -->
      <Grid ColumnDefinitions="2*,10,*" RowDefinitions="Auto,Auto">
        <StackPanel Grid.Column="0" Spacing="5">
          <TextBlock Text="Value *" FontWeight="SemiBold" />
          <TextBox Text="{Binding Value}"
                   Watermark="Enter measured value"
                   IsEnabled="{Binding !IsBusy}" />
        </StackPanel>

        <StackPanel Grid.Column="2" Spacing="5">
          <TextBlock Text="Unit *" FontWeight="SemiBold" />
          <TextBox Text="{Binding Unit}"
                   IsReadOnly="True"
                   IsEnabled="False"
                   Background="#F5F5F5" />
        </StackPanel>
      </Grid>

      <!-- Test Date -->
      <StackPanel Spacing="5">
        <TextBlock Text="Test Date *" FontWeight="SemiBold" />
        <DatePicker SelectedDate="{Binding TestDate}"
                    HorizontalAlignment="Stretch"
                    IsEnabled="{Binding !IsBusy}" />
      </StackPanel>

      <!-- Technician Name -->
      <StackPanel Spacing="5">
        <TextBlock Text="Technician Name *" FontWeight="SemiBold" />
        <TextBox Text="{Binding TechnicianName}"
                 Watermark="Name of technician performing test"
                 MaxLength="100"
                 IsEnabled="{Binding !IsBusy}" />
      </StackPanel>

      <!-- Test Method -->
      <StackPanel Spacing="5">
        <TextBlock Text="Test Method *" FontWeight="SemiBold" />
        <ComboBox ItemsSource="{Binding TestMethods}"
                  SelectedItem="{Binding TestMethod}"
                  HorizontalAlignment="Stretch"
                  IsEnabled="{Binding !IsBusy}" />
      </StackPanel>

      <!-- Compliance Status -->
      <StackPanel Spacing="5">
        <TextBlock Text="Compliance Status" FontWeight="SemiBold" />
        <Border BorderThickness="2"
                CornerRadius="4"
                Padding="10"
                Background="#E8F5E9">
          <StackPanel Orientation="Horizontal" Spacing="10">
            <TextBlock Text="â—"
                       FontSize="20"
                       VerticalAlignment="Center"
                       Foreground="#4CAF50" />
            <TextBlock Text="{Binding ComplianceStatus}"
                       FontSize="16"
                       FontWeight="SemiBold"
                       VerticalAlignment="Center" />
          </StackPanel>
        </Border>
        <TextBlock Text="Auto-calculated based on parameter thresholds"
                   FontSize="11"
                   Foreground="Gray"
                   FontStyle="Italic" />
      </StackPanel>

      <!-- Action Buttons -->
      <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,10,0,0">
        <Button Content="Save"
                Command="{Binding SaveCommand}"
                IsEnabled="{Binding !IsBusy}"
                Classes="accent"
                Padding="20,8" />

        <Button Content="Cancel"
                Command="{Binding CancelCommand}"
                IsEnabled="{Binding !IsBusy}"
                Padding="20,8" />
      </StackPanel>

      <!-- Required Fields Note -->
      <TextBlock Text="* Required fields"
                 FontSize="12"
                 Foreground="Gray"
                 Margin="0,10,0,0" />

    </StackPanel>
  </ScrollViewer>

</UserControl>
