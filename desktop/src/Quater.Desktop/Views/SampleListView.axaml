<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Quater.Desktop.ViewModels"
             xmlns:suki="clr-namespace:SukiUI.Controls;assembly=SukiUI"
             x:Class="Quater.Desktop.Views.SampleListView"
             x:DataType="vm:SampleListViewModel">

    <Design.DataContext>
        <vm:SampleListViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- Header with filters -->
        <suki:GlassCard Grid.Row="0" Margin="10">
            <StackPanel Spacing="10">
                <TextBlock Text="Sample Management" 
                          FontSize="24" 
                          FontWeight="Bold"/>
                
                <Grid ColumnDefinitions="*,*,*,Auto,Auto">
                    <!-- Status Filter -->
                    <StackPanel Grid.Column="0" Margin="0,0,10,0">
                        <TextBlock Text="Status" Margin="0,0,0,5"/>
                        <ComboBox SelectedItem="{Binding StatusFilter}"
                                 PlaceholderText="All Statuses">
                            <ComboBoxItem Content="Pending"/>
                            <ComboBoxItem Content="Completed"/>
                            <ComboBoxItem Content="Archived"/>
                        </ComboBox>
                    </StackPanel>

                    <!-- Start Date Filter -->
                    <StackPanel Grid.Column="1" Margin="0,0,10,0">
                        <TextBlock Text="Start Date" Margin="0,0,0,5"/>
                        <DatePicker SelectedDate="{Binding StartDateFilter}"/>
                    </StackPanel>

                    <!-- End Date Filter -->
                    <StackPanel Grid.Column="2" Margin="0,0,10,0">
                        <TextBlock Text="End Date" Margin="0,0,0,5"/>
                        <DatePicker SelectedDate="{Binding EndDateFilter}"/>
                    </StackPanel>

                    <!-- Filter Button -->
                    <Button Grid.Column="3" 
                           Content="Apply Filters"
                           Command="{Binding LoadSamplesCommand}"
                           VerticalAlignment="Bottom"
                           Margin="0,0,10,0"/>

                    <!-- Clear Filters Button -->
                    <Button Grid.Column="4" 
                           Content="Clear"
                           Command="{Binding ClearFiltersCommand}"
                           VerticalAlignment="Bottom"/>
                </Grid>
            </StackPanel>
        </suki:GlassCard>

        <!-- Data Grid -->
        <suki:GlassCard Grid.Row="1" Margin="10">
            <Grid RowDefinitions="Auto,*">
                <!-- Action Buttons -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="10" Margin="0,0,0,10">
                    <Button Content="New Sample" 
                           Command="{Binding CreateSampleCommand}"/>
                    <Button Content="Edit" 
                           Command="{Binding EditSampleCommand}"
                           CommandParameter="{Binding SelectedSample}"/>
                    <Button Content="Delete" 
                           Command="{Binding DeleteSampleCommand}"
                           CommandParameter="{Binding SelectedSample}"/>
                    <Button Content="Refresh" 
                           Command="{Binding RefreshCommand}"/>
                </StackPanel>

                <!-- Samples DataGrid -->
                <DataGrid Grid.Row="1"
                         ItemsSource="{Binding Samples}"
                         SelectedItem="{Binding SelectedSample}"
                         IsReadOnly="True"
                         GridLinesVisibility="All"
                         BorderThickness="1"
                         AutoGenerateColumns="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="100"/>
                        <DataGridTextColumn Header="Location" Binding="{Binding Location.Description}" Width="200"/>
                        <DataGridTextColumn Header="Latitude" Binding="{Binding Location.Latitude}" Width="100"/>
                        <DataGridTextColumn Header="Longitude" Binding="{Binding Location.Longitude}" Width="100"/>
                        <DataGridTextColumn Header="Collection Date" Binding="{Binding CollectionDate}" Width="150"/>
                        <DataGridTextColumn Header="Collector" Binding="{Binding CollectorName}" Width="150"/>
                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </suki:GlassCard>

        <!-- Footer with count -->
        <suki:GlassCard Grid.Row="2" Margin="10">
            <TextBlock Text="{Binding TotalCount, StringFormat='Total Samples: {0}'}" 
                      FontWeight="Bold"/>
        </suki:GlassCard>

        <!-- Loading Overlay -->
        <Border Grid.Row="0" Grid.RowSpan="3"
               Background="#80000000"
               IsVisible="{Binding IsLoading}">
            <suki:BusyArea IsBusy="True"/>
        </Border>
    </Grid>
</UserControl>
