<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Quater.Desktop.ViewModels"
             xmlns:conv="using:Quater.Desktop.Converters"
             xmlns:suki="clr-namespace:SukiUI.Controls;assembly=SukiUI"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="Quater.Desktop.Views.DashboardView"
             x:DataType="vm:DashboardViewModel">

    <UserControl.Resources>
        <conv:StatusToColorConverter x:Key="StatusToColorConverter" />
    </UserControl.Resources>

    <Design.DataContext>
        <vm:DashboardViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto, *, Auto" Margin="20">
        <!-- Statistiques en haut -->
        <ItemsControl Grid.Row="0" ItemsSource="{Binding Stats}" Margin="0,0,0,20">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid Columns="4" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <suki:GlassCard Margin="6" Padding="18">
                        <StackPanel Spacing="10">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <PathIcon Data="{Binding Icon}" Width="24" Height="24" 
                                          Foreground="{DynamicResource SukiPrimaryColor}" />
                                <TextBlock Text="{Binding Title}" FontWeight="SemiBold" 
                                           VerticalAlignment="Center" FontSize="13"
                                           Foreground="{DynamicResource SukiText_Medium}" />
                            </StackPanel>
                            <TextBlock Text="{Binding Value}" Classes="h2" FontWeight="Bold" 
                                       FontSize="28" Foreground="{DynamicResource SukiText}" />
                        </StackPanel>
                    </suki:GlassCard>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Contenu Principal - Graphique et Liste -->
        <Grid Grid.Row="1" ColumnDefinitions="2*, 1*">
            <!-- Graphique des Tendances -->
            <suki:GlassCard Grid.Column="0" Margin="6" Padding="20">
                <Grid RowDefinitions="Auto, *">
                    <TextBlock Grid.Row="0" Text="Tendances de Conformité (30 Derniers Jours)" 
                               FontWeight="Bold" Margin="0,0,0,15" FontSize="14"
                               Foreground="{DynamicResource SukiText}" />
                    
                    <Grid Grid.Row="1" ColumnDefinitions="*,*,*,*,*,*" RowDefinitions="*,Auto" 
                          Height="200" VerticalAlignment="Bottom">
                        <Border Grid.Column="0" Background="#2196F3" Height="100" VerticalAlignment="Bottom" 
                                CornerRadius="4,4,0,0" Margin="6,0" Opacity="0.8"/>
                        <Border Grid.Column="1" Background="#2196F3" Height="120" VerticalAlignment="Bottom" 
                                CornerRadius="4,4,0,0" Margin="6,0" Opacity="0.85"/>
                        <Border Grid.Column="2" Background="#2196F3" Height="150" VerticalAlignment="Bottom" 
                                CornerRadius="4,4,0,0" Margin="6,0" Opacity="0.9"/>
                        <Border Grid.Column="3" Background="#F44336" Height="50" VerticalAlignment="Bottom" 
                                CornerRadius="4,4,0,0" Margin="6,0" ToolTip.Tip="Pic de Non-Conformité"/> 
                        <Border Grid.Column="4" Background="#2196F3" Height="130" VerticalAlignment="Bottom" 
                                CornerRadius="4,4,0,0" Margin="6,0" Opacity="0.95"/>
                        <Border Grid.Column="5" Background="#2196F3" Height="160" VerticalAlignment="Bottom" 
                                CornerRadius="4,4,0,0" Margin="6,0" />
                        
                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Lun" HorizontalAlignment="Center" 
                                   Margin="0,5,0,0" FontSize="10" Foreground="{DynamicResource SukiText_Medium}"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="Mar" HorizontalAlignment="Center" 
                                   Margin="0,5,0,0" FontSize="10" Foreground="{DynamicResource SukiText_Medium}"/>
                        <TextBlock Grid.Row="1" Grid.Column="2" Text="Mer" HorizontalAlignment="Center" 
                                   Margin="0,5,0,0" FontSize="10" Foreground="{DynamicResource SukiText_Medium}"/>
                        <TextBlock Grid.Row="1" Grid.Column="3" Text="Jeu" HorizontalAlignment="Center" 
                                   Margin="0,5,0,0" FontSize="10" Foreground="{DynamicResource SukiText_Medium}"/>
                        <TextBlock Grid.Row="1" Grid.Column="4" Text="Ven" HorizontalAlignment="Center" 
                                   Margin="0,5,0,0" FontSize="10" Foreground="{DynamicResource SukiText_Medium}"/>
                        <TextBlock Grid.Row="1" Grid.Column="5" Text="Sam" HorizontalAlignment="Center" 
                                   Margin="0,5,0,0" FontSize="10" Foreground="{DynamicResource SukiText_Medium}"/>
                    </Grid>
                </Grid>
            </suki:GlassCard>

            <!-- Liste des Échantillons Récents -->
            <suki:GlassCard Grid.Column="1" Margin="6" Padding="15">
                <Grid RowDefinitions="Auto, *">
                    <TextBlock Grid.Row="0" Text="Échantillons Récents" 
                               FontWeight="Bold" Margin="0,0,0,12" FontSize="14"
                               Foreground="{DynamicResource SukiText}" />
                    
                    <ScrollViewer Grid.Row="1">
                        <ItemsControl ItemsSource="{Binding RecentSamples}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Margin="0,0,0,10" Padding="12" CornerRadius="8" 
                                            Background="{DynamicResource SukiControlBorderBrush}">
                                        <Grid ColumnDefinitions="*, Auto">
                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="{Binding Id}" FontWeight="Bold" FontSize="12" 
                                                           Foreground="{DynamicResource SukiText}" />
                                                <TextBlock Text="{Binding Location}" FontSize="10" 
                                                           Foreground="{DynamicResource SukiText_Medium}" Margin="0,1,0,0" />
                                                <StackPanel Orientation="Horizontal" Spacing="5" Margin="0,4,0,0">
                                                    <TextBlock Text="{Binding Parameter}" FontSize="11" 
                                                               Foreground="{DynamicResource SukiText}"/>
                                                    <TextBlock Text="•" FontSize="11" 
                                                               Foreground="{DynamicResource SukiText_Low}" />
                                                    <TextBlock Text="{Binding Result}" FontSize="11" FontWeight="SemiBold"
                                                               Foreground="{DynamicResource SukiPrimaryColor}" />
                                                </StackPanel>
                                            </StackPanel>
                                            
                                            <Border Grid.Column="1" CornerRadius="12" Padding="8,3" VerticalAlignment="Center" 
                                                    Background="{Binding Status, Converter={StaticResource StatusToColorConverter}}">
                                                <TextBlock Text="{Binding Status}" FontSize="10" FontWeight="SemiBold" 
                                                           Foreground="White" />
                                            </Border>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </suki:GlassCard>
        </Grid>
        
        <!-- Barre d'état -->
        <Border Grid.Row="2" Padding="12" Margin="6,15,6,0" CornerRadius="8" 
                Background="{DynamicResource SukiPrimaryColor}">
            <StackPanel Orientation="Horizontal" Spacing="25">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <PathIcon Data="M4,1H20A2,2 0 0,1 22,3V7A2,2 0 0,1 20,9H4A2,2 0 0,1 2,7V3A2,2 0 0,1 4,1M4,11H20A2,2 0 0,1 22,13V17A2,2 0 0,1 20,19H4A2,2 0 0,1 2,17V13A2,2 0 0,1 4,11M8,5H10V7H8V5M8,15H10V17H8V15M14,15H16V17H14V15Z" 
                                Width="14" Height="14" Foreground="White" />
                    <TextBlock Text="Backend: Connecté (24ms)" FontSize="12" VerticalAlignment="Center"
                               Foreground="White" FontWeight="Medium"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <PathIcon Data="M12,3C16.42,3 20,4.79 20,7C20,9.21 16.42,11 12,11C7.58,11 4,9.21 4,7C4,4.79 7.58,3 12,3M4,9V12C4,14.21 7.58,16 12,16C16.42,16 20,14.21 20,12V9C20,11.21 16.42,13 12,13C7.58,13 4,11.21 4,9M4,14V17C4,19.21 7.58,21 12,21C16.42,21 20,19.21 20,17V14C20,16.21 16.42,18 12,18C7.58,18 4,16.21 4,14M16.5,8.25L15.16,6.91L12,10.07L10.67,8.74L9.33,10.08L12,12.75L16.5,8.25Z" 
                                Width="14" Height="14" Foreground="White" />
                    <TextBlock Text="Sync: À Jour" FontSize="12" VerticalAlignment="Center"
                               Foreground="White" FontWeight="Medium"/>
                </StackPanel>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
